{% extends "base.html" %}

{% block title %}Register - Kerala BLMS{% endblock %}

{% block content %}
<section class="section-padding bg-slate-900 flex justify-center items-center min-h-screen">
  <div class="card-glass p-10 w-full max-w-xl shadow-web3" data-aos="fade-up">
    <h2 class="text-3xl font-display font-bold text-white mb-8 text-center">Create Your Account</h2>

    {% if messages %}
      <div class="mb-6">
        {% for message in messages %}
          <p class="text-sm {% if message.tags == 'error' %}text-red-400{% elif message.tags == 'success' %}text-green-400{% endif %} mb-2">
            {{ message }}
          </p>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" autocomplete="off" novalidate>
      {% csrf_token %}

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="full_name" class="block text-slate-300 mb-2 font-semibold">Full Name</label>
          <input type="text" id="full_name" name="full_name" placeholder="Your full name" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <div>
          <label for="email" class="block text-slate-300 mb-2 font-semibold">Email Address</label>
          <input type="email" id="email" name="email" placeholder="you@example.com" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <div>
          <label for="password" class="block text-slate-300 mb-2 font-semibold">Password</label>
          <input type="password" id="password" name="password" placeholder="••••••••" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <div>
          <label for="confirm_password" class="block text-slate-300 mb-2 font-semibold">Confirm Password</label>
          <input type="password" id="confirm_password" name="confirm_password" placeholder="••••••••" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <!-- Aadhar Input Group -->
        <div class="md:col-span-2">
        <label class="block text-slate-300 mb-2 font-semibold">Aadhar Number</label>
        <div class="flex gap-4 justify-center md:justify-start">
            <input id="aadhar1" name="aadhar_number_part1" type="text" maxlength="4" pattern="\\d{4}" required
            class="w-16 md:w-20 px-4 py-3 rounded-lg bg-slate-800 text-white font-mono text-center tracking-widest border border-slate-700 focus-web3 focus:ring-4 focus:ring-accent-400 transition" />
            <input id="aadhar2" name="aadhar_number_part2" type="text" maxlength="4" pattern="\\d{4}" required
            class="w-16 md:w-20 px-4 py-3 rounded-lg bg-slate-800 text-white font-mono text-center tracking-widest border border-slate-700 focus-web3 focus:ring-4 focus:ring-accent-400 transition" />
            <input id="aadhar3" name="aadhar_number_part3" type="text" maxlength="4" pattern="\\d{4}" required
            class="w-16 md:w-20 px-4 py-3 rounded-lg bg-slate-800 text-white font-mono text-center tracking-widest border border-slate-700 focus-web3 focus:ring-4 focus:ring-accent-400 transition" />
        </div>
        <input type="hidden" id="aadhar_number" name="aadhar_number" />
        </div>

        <!-- PAN Input -->
        <div>
        <label for="pan_number" class="block text-slate-300 mb-2 font-semibold">PAN Number</label>
        <input type="text" id="pan_number" name="pan_number" maxlength="10" placeholder="10-character PAN" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-white font-mono uppercase tracking-widest border border-slate-700 focus-web3 focus:ring-4 focus:ring-accent-400 transition" />
        </div>


        <div>
          <label for="phone" class="block text-slate-300 mb-2 font-semibold">Phone Number</label>
          <input type="text" id="phone" name="phone" placeholder="Phone Number" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <div>
          <label for="date_of_birth" class="block text-slate-300 mb-2 font-semibold">Date of Birth</label>
          <input type="date" id="date_of_birth" name="date_of_birth" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>


        <div class="md:col-span-2">
          <label for="address" class="block text-slate-300 mb-2 font-semibold">Address</label>
          <textarea id="address" name="address" rows="3" placeholder="Residential Address" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3"></textarea>
        </div>

        <div>
          <label for="city" class="block text-slate-300 mb-2 font-semibold">City</label>
          <input type="text" id="city" name="city" placeholder="City" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <div>
          <label for="state" class="block text-slate-300 mb-2 font-semibold">State</label>
          <input type="text" id="state" name="state" placeholder="State" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>

        <div>
          <label for="pincode" class="block text-slate-300 mb-2 font-semibold">PIN Code</label>
          <input type="text" id="pincode" name="pincode" placeholder="6-digit PIN code" maxlength="6" required
            class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3" />
        </div>
      </div>

      <div class="md:col-span-2">
  <label for="eth_address" class="block text-slate-300 mb-2 font-semibold">
    Ethereum Wallet (optional)
  </label>

  <input type="text"
    id="eth_address"
    name="eth_address"
    placeholder="0xYourWalletAddress"
    class="w-full px-4 py-3 rounded-lg bg-slate-800 text-slate-100 border border-slate-700 focus-web3"
  />

  <p class="text-slate-500 text-xs mt-1">
    Used for blockchain-based land transactions. You can add/change later.
  </p>
</div>


      <button type="submit" class="btn-primary w-full mt-8 text-lg">Register</button>
    </form>

    <p class="mt-6 text-center text-slate-400">
      Already have an account?
      <a href="{% url 'customer_login' %}" class="text-accent-400 hover:underline">Login here</a>
    </p>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const inputs = document.querySelectorAll('input, textarea');
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        input.classList.add('ring-2', 'ring-accent-400');
      });
      input.addEventListener('blur', () => {
        input.classList.remove('ring-2', 'ring-accent-400');
      });
    });
  });

  document.addEventListener('DOMContentLoaded', () => {
    const aadharInputs = [
      document.getElementById('aadhar1'),
      document.getElementById('aadhar2'),
      document.getElementById('aadhar3')
    ];
    const hiddenAadharInput = document.getElementById('aadhar_number');

    aadharInputs.forEach((input, idx) => {
      input.addEventListener('input', (e) => {
        // Only digits allowed
        e.target.value = e.target.value.replace(/\\D/g, '');

        // Move to next input when max length (4) reached
        if (e.target.value.length === 4 && idx < aadharInputs.length - 1) {
          aadharInputs[idx + 1].focus();
        }

        // Update hidden combined Aadhar field
        hiddenAadharInput.value = aadharInputs.map(i => i.value).join('');
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && e.target.value.length === 0 && idx > 0) {
          aadharInputs[idx - 1].focus();
        }
      });
    });

    // Force uppercase for PAN input
    const panInput = document.getElementById('pan_number');
    panInput.addEventListener('input', () => {
      panInput.value = panInput.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    });
  });
</script>
{% endblock %}
